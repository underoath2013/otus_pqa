Импортируем необходимые модули и библиотеки: os, re и json.  
Определяем две основные функции: process_log_file(file_path) и process_logs_in_directory(directory_path).
Функция process_log_file(file_path):  
Открывает указанный лог-файл file_path для чтения.  
Определяет регулярное выражение pattern для извлечения информации из каждой строки лога.  
Производит поиск всех соответствий регулярному выражению в содержимом файла.  
Для каждого соответствия:  
Увеличивает счетчик общего количества запросов.  
Считает количество запросов для каждого метода HTTP и сохраняет в словаре http_method_counts.  
Считает количество запросов для каждого IP-адреса и сохраняет в словаре ip_counts.  
Создает словарь с информацией о запросе (метод, URL, IP, длительность, время, когды был сделан запрос) и добавляет его в список longest_requests.  
Выбирает топ 3 IP-адреса с наибольшим количеством запросов и топ 3 самых долгих запросов.  
Выводит в консоль информацию по файлу.  
Возвращает словарь с результатами анализа файла.  

Функция process_logs_in_directory(directory_path):  
Проходит по всем файлам в указанной директории directory_path и поддиректориям.  
Для каждого файла с расширением .log вызывает функцию process_log_file(file_path) и добавляет результаты анализа в список.  
Возвращает список с результатами анализа всех файлов в директории.  

В функции main() запрашиваем у пользователя путь к директории или файлу логов.  
После ввода пользователя:  
Если указан путь к директории, вызывается функция process_logs_in_directory(directory_path) для анализа всех файлов в директории.  
Если указан путь к файлу .log, вызывается функция process_log_file(file_path) для анализа одного файла.  

Вспомогательная функция save_result_to_json(all_output_data) сохраняет результаты анализа в файл output.json в формате JSON.
